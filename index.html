<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DSA Instructor AI Dashboard</title>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* CSS based on the user's provided styling for a dark-mode dashboard */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #7e6fff;
            --primary-dark: #6a5af9;
            --secondary: #00d4ff;
            --dark-bg: #121826;
            --dark-card: #1e293b;
            --dark-border: #2d3749;
            --text-primary: #e2e8f0;
            --text-secondary: #94a3b8;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --code-bg: #0f172a;
            --sidebar-width: 280px;
            --transition: all 0.3s ease;
        }

        body {
            background-color: var(--dark-bg);
            color: var(--text-primary);
            display: flex;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background-color: #0c1120;
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            padding: 25px 0;
            border-right: 1px solid var(--dark-border);
            display: flex;
            flex-direction: column;
            z-index: 100;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 0 25px 30px;
            border-bottom: 1px solid var(--dark-border);
            margin-bottom: 30px;
        }

        .logo-icon {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            width: 45px;
            height: 45px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .logo-text {
            font-size: 1.4rem;
            font-weight: 700;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .sidebar-menu {
            padding: 0 15px;
            flex-grow: 1;
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 14px 20px;
            border-radius: 10px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: var(--transition);
            color: var(--text-secondary);
        }

        .menu-item:hover, .menu-item.active {
            background: rgba(126, 111, 255, 0.1);
            color: var(--primary);
        }

        .menu-item i {
            width: 24px;
            text-align: center;
        }
        
        .menu-text {
            font-size: 1.1rem;
        }

        .sidebar-footer {
            padding: 20px 25px 0;
            border-top: 1px solid var(--dark-border);
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            padding: 30px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.2rem;
            font-weight: 700;
            background: linear-gradient(to right, var(--text-primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .user-controls {
            display: flex;
            gap: 15px;
        }

        .btn {
            background: var(--dark-card);
            border: 1px solid var(--dark-border);
            color: var(--text-primary);
            padding: 10px 18px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
        }

        .btn:hover {
            background: rgba(126, 111, 255, 0.1);
            border-color: var(--primary);
        }

        /* Dashboard Grid */
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 30px;
        }

        .card {
            background: var(--dark-card);
            border-radius: 16px;
            border: 1px solid var(--dark-border);
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .card-header {
            padding: 20px 25px;
            border-bottom: 1px solid var(--dark-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-header h2 {
            font-size: 1.3rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .card-body {
            padding: 25px;
        }

        /* Input Section */
        .input-section {
            grid-column: span 2;
        }

        .instructions {
            background: rgba(30, 41, 59, 0.7);
            border-left: 4px solid var(--primary);
            padding: 18px 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            display: flex;
            gap: 15px;
            backdrop-filter: blur(5px);
        }

        .instructions i {
            color: var(--primary);
            font-size: 1.4rem;
            margin-top: 3px;
        }

        .instructions p {
            margin-bottom: 10px;
            color: var(--text-primary);
            line-height: 1.6;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 12px;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.1rem;
        }

        textarea#questionInput {
            width: 100%;
            padding: 18px;
            border: 1px solid var(--dark-border);
            border-radius: 12px;
            font-size: 16px;
            min-height: 150px;
            resize: vertical;
            transition: var(--transition);
            background: rgba(30, 41, 59, 0.5);
            color: var(--text-primary);
            font-family: 'Segoe UI', monospace;
        }

        textarea#questionInput:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(126, 111, 255, 0.2);
        }

        textarea#questionInput::placeholder {
            color: #64748b;
        }

        button#askButton {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 18px 25px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            width: 100%;
            box-shadow: 0 4px 15px rgba(126, 111, 255, 0.3);
        }

        button#askButton:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(126, 111, 255, 0.4);
        }

        button#askButton:active {
            transform: translateY(0);
        }

        button#askButton:disabled {
            background: #64748b;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Output Section */
        .output-section {
            grid-column: span 2;
        }

        .output-container {
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--dark-border);
            background: rgba(30, 41, 59, 0.5);
        }

        #outputArea {
            padding: 30px;
            min-height: 250px;
            white-space: pre-wrap;
            word-wrap: break-word;
            line-height: 1.7;
            font-size: 16px;
            background: transparent;
            max-height: 400px;
            overflow-y: auto;
        }

        #outputArea::-webkit-scrollbar {
            width: 8px;
        }

        #outputArea::-webkit-scrollbar-track {
            background: rgba(30, 41, 59, 0.5);
            border-radius: 4px;
        }

        #outputArea::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }

        #outputArea p {
            margin-bottom: 20px;
        }

        #outputArea pre {
            background: var(--code-bg);
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 20px 0;
        }
        
        #outputArea code {
            font-family: 'Fira Code', monospace;
            font-size: 15px;
            color: var(--secondary);
        }
        
        #outputArea pre code {
            display: block; /* Make sure pre-formatted code blocks respect newlines */
            white-space: pre;
        }
        
        #outputArea ul {
            padding-left: 20px;
            margin-bottom: 20px;
        }
        
        #outputArea li {
            margin-bottom: 5px;
        }

        .loading-indicator {
            text-align: center;
            padding: 30px;
            display: none;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(126, 111, 255, 0.2);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error-message {
            color: var(--danger);
            background: rgba(239, 68, 68, 0.1);
            padding: 20px;
            border-radius: 12px;
            margin: 15px 0;
            border-left: 4px solid var(--danger);
            font-weight: 500;
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        /* The stats section was missing a container, adding it here */
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }

        .stat-card {
            background: rgba(30, 41, 59, 0.7);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--dark-border);
            text-align: center;
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 10px 0;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        /* Responsive Design */
        @media (max-width: 1100px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .input-section, .output-section {
                grid-column: span 1;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 70px;
                overflow: hidden;
            }
            
            .logo-text, .menu-text, .sidebar-footer {
                display: none;
            }
            
            .logo {
                justify-content: center;
                padding: 0 10px 20px;
            }
            
            .menu-item {
                justify-content: center;
                padding: 15px;
            }
            
            .main-content {
                margin-left: 70px;
                padding: 20px;
            }
            
            .header {
                flex-direction: column;
                align-items: flex-start;
                gap: 20px;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
        }

        @media (max-width: 480px) {
            .sidebar {
                display: none;
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="logo">
            <div class="logo-icon">
                <i class="fas fa-microchip"></i>
            </div>
            <div class="logo-text">DSA AI</div>
        </div>
        
        <div class="sidebar-menu">
            <div class="menu-item active">
                <i class="fas fa-tachometer-alt"></i>
                <span class="menu-text">Dashboard</span>
            </div>
            <div class="menu-item">
                <i class="fas fa-sitemap"></i>
                <span class="menu-text">Data Structures</span>
            </div>
            <div class="menu-item">
                <i class="fas fa-route"></i>
                <span class="menu-text">Algorithms</span>
            </div>
            <div class="menu-item">
                <i class="fas fa-dumbbell"></i>
                <span class="menu-text">Practice</span>
            </div>
            <div class="menu-item">
                <i class="fas fa-history"></i>
                <span class="menu-text">History</span>
            </div>
        </div>
        
        <div class="sidebar-footer">
            <p>DSA AI v1.0</p>
            <p>Powered by Gemini API</p>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
        <div class="header">
            <h1>Data Structures & Algorithms Instructor</h1>
            <div class="user-controls">
                <button class="btn">
                    <i class="fas fa-moon"></i>
                    <span>Dark Mode</span>
                </button>
                <button class="btn">
                    <i class="fas fa-user-circle"></i>
                    <span>Profile</span>
                </button>
            </div>
        </div>
        
        <div class="dashboard">
            <!-- Stats Cards -->
            <div class="card input-section">
                <div class="card-body">
                    <div class="stats">
                        <div class="stat-card">
                            <i class="fas fa-book-reader fa-2x" style="color: var(--primary);"></i>
                            <div class="stat-value">52</div>
                            <div class="stat-label">Concepts Learned</div>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-brain fa-2x" style="color: var(--secondary);"></i>
                            <div class="stat-value">124</div>
                            <div class="stat-label">Problems Solved</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h2><i class="fas fa-fire" style="color: var(--warning);"></i> Popular Topics</h2>
                </div>
                <div class="card-body">
                    <ul style="list-style-type: none; line-height: 2.2;">
                        <li><i class="fas fa-chevron-right" style="color: var(--primary); margin-right: 10px;"></i> Linked Lists</li>
                        <li><i class="fas fa-chevron-right" style="color: var(--primary); margin-right: 10px;"></i> Binary Search Trees</li>
                        <li><i class="fas fa-chevron-right" style="color: var(--primary); margin-right: 10px;"></i> Hash Tables</li>
                        <li><i class="fas fa-chevron-right" style="color: var(--primary); margin-right: 10px;"></i> Dynamic Programming</li>
                        <li><i class="fas fa-chevron-right" style="color: var(--primary); margin-right: 10px;"></i> Graph Traversal</li>
                    </ul>
                </div>
            </div>
            
            <!-- Input Section -->
            <div class="card input-section">
                <div class="card-header">
                    <h2><i class="fas fa-question-circle" style="color: var(--secondary);"></i> Ask a DSA Question</h2>
                </div>
                <div class="card-body">
                    <div class="instructions">
                        <i class="fas fa-info-circle"></i>
                        <div>
                            <p><strong>How to use:</strong> Ask any question about Data Structures or Algorithms. I will provide a detailed explanation and code examples.</p>
                            <p>For questions outside the scope of DSA, I will kindly remind you of my purpose.</p>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="questionInput">
                            <i class="fas fa-laptop-code"></i>
                            Your DSA Question
                        </label>
                        <textarea id="questionInput" placeholder="e.g., What is a stack? How does a binary search tree work? Show me an example of Dijkstra's algorithm."></textarea>
                    </div>
                    
                    <button id="askButton">
                        <i class="fas fa-paper-plane"></i>
                        Get Explanation
                    </button>
                </div>
            </div>
            
            <!-- Output Section -->
            <div class="card output-section">
                <div class="card-header">
                    <h2><i class="fas fa-graduation-cap" style="color: var(--success);"></i> Instructor's Response</h2>
                </div>
                <div class="card-body">
                    <div class="loading-indicator" id="loadingIndicator">
                        <div class="spinner"></div>
                        <p>Analyzing your question and preparing the best explanation...</p>
                    </div>
                    
                    <div class="output-container">
                        <div id="outputArea">
                            <p>Welcome to the DSA Instructor AI! I'm here to help you master Data Structures and Algorithms. Feel free to ask me anything related to the topic.</p>
                            <p>Try asking me about:</p>
                            <ul>
                                <li>The difference between a stack and a queue</li>
                                <li>The time complexity of quicksort</li>
                                <li>How to implement a linked list in Python</li>
                                <li>An explanation of dynamic programming</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const questionInput = document.getElementById('questionInput');
        const askButton = document.getElementById('askButton');
        const outputArea = document.getElementById('outputArea');
        const loadingIndicator = document.getElementById('loadingIndicator');

        // The API key is automatically provided by the Canvas environment.
        const apiKey = "AIzaSyDHGbh0AddQN1v6SITV8oQkj37B0VutsMA";
        const MODEL_NAME = "gemini-2.5-flash-preview-05-20";

        // System instruction for the AI, as requested by the user
        const systemInstructionText = "You are Data Structures and Algorithms instructors. you will reply only to the questions related to DSA.if user asked any other question then you will reply with 'I am DSA instructor, I can only answer questions related to DSA.If you have any questions related to DSA, feel free to ask!'";

        /**
         * Asynchronously calls the Gemini API to get a response.
         * It implements exponential backoff for handling rate limits.
         * @param {string} question The user's prompt.
         * @param {number} retries Number of retry attempts.
         * @param {number} delay Initial delay for backoff.
         * @returns {Promise<string>} The AI's response text.
         */
        async function callGeminiAPI(question, retries = 3, delay = 1000) {
            const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent?key=${apiKey}`;
            const requestBody = {
                contents: [{
                    role: "user",
                    parts: [{ text: question }]
                }],
                systemInstruction: {
                    parts: [{ text: systemInstructionText }]
                }
            };
            
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestBody),
                });

                if (response.status === 429 && retries > 0) {
                    await new Promise(res => setTimeout(res, delay));
                    return callGeminiAPI(question, retries - 1, delay * 2);
                }

                if (!response.ok) {
                    let errorDetails = "Unknown API Error";
                    try {
                        const errorData = await response.json();
                        errorDetails = errorData?.error?.message || errorDetails;
                    } catch (parseError) {
                        // Ignore parsing errors for the error message itself
                    }
                    throw new Error(`API call failed: ${response.status} - ${errorDetails}`);
                }

                const data = await response.json();
                
                if (data.candidates && data.candidates.length > 0 &&
                    data.candidates[0].content && data.candidates[0].content.parts &&
                    data.candidates[0].content.parts.length > 0) {
                    return data.candidates[0].content.parts[0].text;
                } else if (data.promptFeedback && data.promptFeedback.blockReason) {
                    return `Blocked due to: ${data.promptFeedback.blockReason}`;
                } else {
                    return "Received an unexpected response from the AI.";
                }
            } catch (error) {
                console.error('API call error:', error);
                return `An error occurred: ${error.message}.`;
            }
        }

        // Event listener for the "Ask Coding Instructor" button
        askButton.addEventListener('click', async () => {
            const question = questionInput.value.trim();

            if (!question) {
                outputArea.innerHTML = '<div class="error-message"><i class="fas fa-exclamation-circle"></i> Please enter a DSA question first!</div>';
                return;
            }

            // Show loading state
            outputArea.innerHTML = '';
            loadingIndicator.style.display = 'block';
            askButton.disabled = true;

            // Call the API with the user's question
            const answerText = await callGeminiAPI(question);

            // Hide loading state and display the response
            loadingIndicator.style.display = 'none';
            askButton.disabled = false;

            // Format the response with simple HTML tags
            let formattedText = answerText.replace(/(```[\s\S]*?```)/g, (match) => {
                const codeContent = match.replace(/```/g, '').trim();
                return `<pre><code>${codeContent}</code></pre>`;
            });
            formattedText = formattedText.replace(/`([^`]+)`/g, '<code>$1</code>');
            
            const paragraphs = formattedText.split('\n\n').map(p => {
                if (p.trim() !== '') {
                    return `<p>${p.trim()}</p>`;
                }
                return '';
            }).join('');
            
            outputArea.innerHTML = paragraphs;
        });

        // Allow Enter key (but not Shift+Enter) in textarea to submit
        questionInput.addEventListener('keypress', function(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                askButton.click();
            }
        });

        // Add demo functionality for UI menu items
        document.querySelectorAll('.menu-item').forEach(item => {
            item.addEventListener('click', function() {
                document.querySelectorAll('.menu-item').forEach(i => i.classList.remove('active'));
                this.classList.add('active');
            });
        });

    </script>
</body>
</html>
